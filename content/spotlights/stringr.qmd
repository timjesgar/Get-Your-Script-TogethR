---
title: "stringr für das Arbeiten mit Textdaten"
author: "TLJ"
toc: true

code-tools:
    source: true
    toggle: false
---

## Worum geht es?

Immer wieder ist es notwendig, dass wir wichtige Informationen als geschriebenen Text, sogenannte **Strings**, vorliegen haben. Sei es demographische Daten wie Abschluss, Ort und Zeit der Erhebung oder die Experimentalbedingungen in einem Experiment. Leider sind solche Textdaten oft "messy": Inkonsistente Groß- und Kleinschreibung, Leerzeilen wo keine hingehören, unterschiedliche Schreibweisen für das gleiche Konzept (z.B. "männlich", "Männlich"), und und und. 

Das R-Paket **stringr** bietet eine Vielzahl an Funktionen, um solche Textdaten zu bereinigen, zu transformieren und zu analysieren. Es ist Teil des **tidyverse**, einer Sammlung von R-Paketen, die für Datenwissenschaft entwickelt wurden und alle nach dem Prinzip der "Tidy Data" arbeiten. Ihr kennt sicher schon das ein oder andere Paket aus dem **tidyverse**, wie z.B. **dplyr** für die allgemeine Datenmanipulation oder **ggplot2** für die Datenvisualisierung.

## Wofür kann man es nutzen?

**stringr** bietet Funktionen für eine Vielzahl von Aufgaben im Umgang mit Textdaten, darunter: das einfache Formatieren von Text, das Suchen und Ersetzen von Text, das Extrahieren von Teilstrings, das Aufteilen von Strings in mehrere Teile, das Zusammenfügen von Strings, und vieles mehr. Schaut euch gerne mal das Cheatsheet an, welches ihr auf der [stringr Webseite](https://stringr.tidyverse.org/) findet, um euch einen Überblick über die verschiedenen Funktionen zu machen. 

### Beispiel: Formatieren von Text

Nehmen wir an, wir haben sieben Personen gefragt, welchen Lieblingsfilm sie haben und die Antworten in einem Vektor gespeichert. Leider sind die Antworten jedoch sehr inkonsistent formatirert, was die weitere Analyse schwierig macht.

```{r}
#| label: text_raw
library(stringr)

# Rohdaten
text_raw <- c(
  'Titanic',
  'avatar',
  'titanic',
  'The  Godfather',
  'AVATAR',
  'inception ',
  'Inception'
)

# Zählen wir wie oft jeder Film genannt wurde
table(text_raw)
```

Obwohl "Avatar", "Titanic" und "Inception" je zweimal genannt wurden, sehen wir, dass die unterschiedlichen Schreibweisen dazu führen, dass sie als verschiedene Filme gezählt werden. Wir können **stringr** nutzen, um die Antworten zu bereinigen und zu standardisieren (und sie nebenbei auch etwas schöner zu formatieren).

```{r}
#| label: text_clean

text_clean <-
  text_raw |>
  str_to_title() |> # Großschreibung am Anfang jedes Wortes
  str_squish() # Leerzeichen am Anfang und Ende entfernen und zwischen Wörtern auf ein Leerzeichen reduzieren

table(text_clean)
```

Und oh Wunder, nach der Bereinigung sehen wir, dass "Avatar", "Titanic" und "Inception" jeweils zweimal genannt wurden!

### Beispiel: Extrahieren von Teilstrings

Nehmen wir an, wir haben eine Liste von E-Mail-Adressen und wollen nur die Domain-Namen extrahieren (also den Teil nach dem "@"-Zeichen). Dafür können wir **stringr**'s `str_extract()` Funktion zusammen mit *Regular Expressions* nutzen. *Regular Expressions* sind eine spezifische "Sprache", mit der man Muster in Texten beschreiben kann. Ich werde hier nicht näher auf *Regular Expressions* eingehen, aber es gibt viele tolle Ressourcen online, um das zu lernen (siehe unten).

Nun aber zum Beispiel: Zuerst definieren wir einen Vektor mit E-Mail-Adressen.

```{r}
#| label: email_raw

# Rohdaten
email_raw <- c(
  'max.mustermann@domain1.de',
  'maxine.musterfrau@domain2.de',
  'micah.musterperson@domain3.de'
)

# Extrahieren der Domain-Namen
str_extract(email_raw, "(?<=@).*(?=\\.de)")
```

Die *Regular Expression* `(?<=@).*(?=\\.de)` sieht erstmal nach viel Kauderwelsch aus. Was es aber im Prinzip aussagt ist: Finde den ganzen Text (`.*`), der nach einem "@" (`(?<=@)`) und vor einem ".de" (`(?=\\.de)`) steht. Mittels dieser Funktionalität können wir also gezielt Teile von Strings extrahieren, die bestimmte Muster erfüllen.


### Und Und Und

Ihr seht, **stringr** ist ein mächtiges Werkzeug für die Arbeit mit Textdaten in R. Die beiden Beispiele hier sind nur ein kleiner Ausblick auf das, was mit **stringr** möglich ist. Falls ihr also das nächste Mal auf Textdaten trefft, die bereinigt oder analysiert werden müssen, denkt daran, dass **stringr** euch dabei helfen kann!

## Wo finde ich mehr Informationen?

- Für den allgemeinen Überblickk: [Die offizielle Dokumentation](https://stringr.tidyverse.org/)
- Zum Lernen wie man mit *Strings* (Zeichenketten) umgeht: [Strings Kapitel in dem Online-Buch *R for Data Science*](https://r4ds.hadley.nz/strings.html)
- Zum Lernen von *Regular Expressions*: [Regex Kreuzworträtsel](https://regexcrossword.com/)


